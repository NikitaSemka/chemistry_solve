<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Формулы по химии</title>
    <meta name="description" content="Уравнивание формул">
    <link rel="stylesheet" href="main.css">
</head>

<body>

    <h1>Уравнивание химических формул</h1>
    <h2>Введите формулу ниже:</h2>

    <input type="text" id="myInput" placeholder="2H2 + 3O2 = 4H2O" class="input">

    <button onclick="getText()">Нажми чтобы рассчитать</button>

    <div id="result">Итог: ...</div>

    <button class="hidenBtn" id="secretBtn" onclick="window.location.href='secrect.html'">Секретная кнопка</button>

    <script>
        function dictToHTML(dict) {
            let html = "";
            for (let key in dict) {
                html += `${key}: ${dict[key]}<br>`;
            }
            return html || "нет элементов";
        }

        function parse(side) {
            const parts = side.replace(/\+/g, " ").trim().split(/\s+/);
            const lib = {};

            for (let part of parts) {
                if (!part) continue;

                let coefMatch = part.match(/^(\d+)?(.*)$/);
                let coef = coefMatch[1] ? parseInt(coefMatch[1]) : 1;
                let formula = coefMatch[2];

                let matches = formula.matchAll(/([A-Z][a-z]?)(\d*)/g);

                for (let match of matches) {
                    let elem = match[1];
                    let num = match[2] ? parseInt(match[2]) : 1;
                    lib[elem] = (lib[elem] || 0) + num * coef;
                }
            }
            return lib;
        }

        function getText() {
            const text = document.getElementById("myInput").value.trim();
            const result = document.getElementById("result");
            const secretBtn = document.getElementById("secretBtn");

            // Проверка секретного кода
            if (text === "676767") {
                secretBtn.style.display = "block";
                result.innerHTML = "Секретный код активирован!";
                return;
            } else {
                secretBtn.style.display = "none";
            }

            if (!text.includes("=")) {
                result.innerHTML = "Ошибка: формула должна содержать знак «=». Пример: <b>2H2 + O2 = 2H2O</b>";
                return;
            }

            const [left, right] = text.split("=");

            const leftDict = parse(left);
            const rightDict = parse(right);

            result.innerHTML =
                `<div class="block-title">Левая часть:</div>${dictToHTML(leftDict)}` +
                `<div class="block-title">Правая часть:</div>${dictToHTML(rightDict)}`;
        }
    </script>

</body>
</html>